<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç ”ç™¼éƒ¨ç¶²é å°ˆç”¨é€£çµ</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- React Libraries (Production Version for better performance) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel to compile JSX in browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .card-container {
      display: grid;
      /* èª¿æ•´å¡ç‰‡æœ€å°å¯¬åº¦å¾ 280px -> 220pxï¼Œé–“è·å¾ 1.5rem -> 1rem */
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1rem;
    }
    .loader, .btn-loader {
      border: 4px solid #f3f3f3;
      border-radius: 50%;
      border-top: 4px solid #3498db;
      animation: spin 1s linear infinite;
    }
    .loader {
      width: 40px;
      height: 40px;
      margin: 20px auto;
    }
    .btn-loader {
        width: 20px;
        height: 20px;
        border-top-color: white;
        display: inline-block;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* è‡ªè¨‚æ ¸å–æ–¹å¡Šæ¨£å¼ */
    .form-checkbox {
      appearance: none;
      -webkit-appearance: none;
      height: 1.25rem;
      width: 1.25rem;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 0.25rem;
      display: inline-block;
      vertical-align: middle;
      position: relative;
      cursor: pointer;
    }
    .form-checkbox:checked {
      background-color: #3b82f6;
      border-color: #3b82f6;
    }
    .form-checkbox:checked::after {
      content: 'âœ”';
      font-size: 0.75rem;
      color: white;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .toast-enter { transform: translateX(100%); opacity: 0; }
    .toast-enter-active { transform: translateX(0); opacity: 1; transition: all 300ms ease-out; }
    .toast-exit { transform: translateX(0); opacity: 1; }
    .toast-exit-active { transform: translateX(100%); opacity: 0; transition: all 300ms ease-in; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">

  <div id="root"></div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getFirestore, collection, query, onSnapshot, addDoc, updateDoc, deleteDoc, doc, orderBy } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
    import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";
    
    // å°‡ Firebase æ¨¡çµ„æ›è¼‰åˆ° window ä»¥ä¾¿åœ¨ Babel script ä¸­ä½¿ç”¨
    window.firebase = {
        initializeApp,
        getFirestore,
        collection,
        query,
        onSnapshot,
        addDoc,
        updateDoc,
        deleteDoc,
        doc,
        orderBy,
        getAuth,
        signInAnonymously,
        getStorage,
        ref,
        uploadBytes,
        getDownloadURL,
        deleteObject
    };
  </script>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useMemo } = React;
    
    // ç­‰å¾… window.firebase åˆå§‹åŒ–
    const useFirebaseLib = () => {
        const [fbLib, setFbLib] = useState(null);
        useEffect(() => {
            const checkFirebase = setInterval(() => {
                if (window.firebase) {
                    setFbLib(window.firebase);
                    clearInterval(checkFirebase);
                }
            }, 50);
            return () => clearInterval(checkFirebase);
        }, []);
        return fbLib;
    };

    // --- çµ„æ…‹ (æ³¨æ„ï¼šå‰ç«¯ç¡¬ç·¨ç¢¼å¯†ç¢¼æ¥µä¸å®‰å…¨ï¼Œå»ºè­°åƒ…ç”¨æ–¼å…§éƒ¨ä½é¢¨éšªç’°å¢ƒ) ---
    const ADMIN_PASSWORD = "7777"; 

    // --- Firebase Config ---
    const firebaseConfig = {
      apiKey: "AIzaSyDZMH8jbae1H7n3F5GJ8IeNMpuYhV0hxzQ",
      authDomain: "rd202507229.firebaseapp.com",
      databaseURL: "https://rd202507229-default-rtdb.firebaseio.com",
      projectId: "rd202507229",
      storageBucket: "rd202507229.firebasestorage.app",
      messagingSenderId: "893455158003",
      appId: "1:893455158003:web:4cef1387cff07507724586",
      measurementId: "G-9WB39RZNR1"
    };

    // --- é€šç”¨çµ„ä»¶ ---
    const Modal = ({ children, onClose, maxWidth = 'max-w-sm' }) => (
        <div className="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4 transition-opacity" onClick={onClose}>
            <div className={`bg-white rounded-2xl shadow-2xl p-6 sm:p-8 w-full ${maxWidth} overflow-y-auto max-h-[90vh] transform transition-all scale-100`} onClick={(e) => e.stopPropagation()}>
                {children}
            </div>
        </div>
    );

    const Notification = ({ message, success }) => (
        <div className={`fixed top-5 right-5 text-white py-3 px-6 rounded-xl shadow-lg z-50 transition-all duration-300 transform translate-x-0 flex items-center gap-2 ${success ? 'bg-green-600' : 'bg-red-600'}`}>
            <span className="text-xl">{success ? 'âœ“' : 'âœ•'}</span>
            <p className="font-medium">{message}</p>
        </div>
    );

    const CopyButton = ({ text, label }) => {
        const [copied, setCopied] = useState(false);
        
        const handleCopy = (e) => {
            e.preventDefault();
            navigator.clipboard.writeText(text).then(() => {
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            });
        };

        return (
            <button 
                onClick={handleCopy} 
                title="è¤‡è£½é€£çµ"
                className={`ml-1.5 p-1 rounded transition-colors ${copied ? 'text-green-600 bg-green-50' : 'text-gray-400 hover:text-gray-600 hover:bg-gray-100'}`}
            >
                {copied ? (
                    <span className="text-[10px] font-bold">å·²è¤‡è£½</span>
                ) : (
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                    </svg>
                )}
            </button>
        );
    };
    
    // --- å¡ç‰‡çµ„ä»¶ (å°ºå¯¸ç¸®å°ç‰ˆ) ---
    const SiteCard = ({ site, isAdmin, onEdit, onDelete }) => {
        const showFile = (isAdmin || site.showFileLink !== false) && site.downloadUrl;
        const showGithub = (isAdmin || site.showGithubLink !== false) && site.githubUrl;
        const showGemini = (isAdmin || site.showGeminiLink !== false) && site.url;

        return (
            // padding å¾ p-5 æ”¹ç‚º p-4, æ¨™é¡Œå¾ text-lg æ”¹ç‚º text-base
            <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col justify-between transition-all duration-300 hover:shadow-lg hover:-translate-y-1 hover:border-blue-200 group">
                <div>
                    <h3 className="text-base font-bold text-gray-800 mb-2 truncate flex items-center gap-2">
                        <span className="w-1.5 h-5 bg-blue-500 rounded-full inline-block"></span>
                        {site.name}
                    </h3>
                    
                    <div className="flex flex-col space-y-2 pt-1">
                        
                        {showFile && (
                            <div className="flex items-center justify-between group/item">
                                <div className="flex gap-1.5 items-center">
                                    <a href={site.downloadUrl} target="_blank" rel="noopener noreferrer" className="flex items-center gap-1.5 text-sky-600 hover:text-sky-800 font-medium text-xs transition-colors bg-sky-50 px-2 py-1 rounded hover:bg-sky-100 w-fit">
                                        <span>ğŸ“‚</span> æ‰“é–‹
                                    </a>
                                    <a href={site.downloadUrl} download className="flex items-center gap-1 text-green-600 hover:text-green-800 font-medium text-xs transition-colors p-1 rounded hover:bg-green-50" title="ä¸‹è¼‰">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                        </svg>
                                    </a>
                                </div>
                                <CopyButton text={site.downloadUrl} />
                            </div>
                        )}

                        {showGithub && (
                            <div className="flex items-center justify-between group/item">
                                <a href={site.githubUrl} target="_blank" rel="noopener noreferrer" className="flex items-center gap-1.5 text-gray-700 hover:text-black font-medium text-xs transition-colors bg-gray-100 px-2 py-1 rounded hover:bg-gray-200 w-fit">
                                    <span>ğŸ’»</span> GitHub
                                </a>
                                <CopyButton text={site.githubUrl} />
                            </div>
                        )}

                        {showGemini && (
                            <div className="flex items-center justify-between group/item">
                                <a href={site.url} target="_blank" rel="noopener noreferrer" className="flex items-center gap-1.5 text-indigo-600 hover:text-indigo-800 font-medium text-xs transition-colors bg-indigo-50 px-2 py-1 rounded hover:bg-indigo-100 w-fit">
                                    <span>ğŸ¤–</span> Gemini
                                </a>
                                <CopyButton text={site.url} />
                            </div>
                        )}

                        {!isAdmin && !showFile && !showGithub && !showGemini && (
                            <div className="bg-gray-50 p-2 rounded-lg text-center border border-dashed border-gray-300">
                                <p className="text-xs text-gray-400">æš«ç„¡é€£çµ</p>
                            </div>
                        )}
                    </div>
                </div>
                
                {isAdmin && (
                    <div className="flex gap-2 mt-4 pt-3 border-t border-gray-100 opacity-100 transition-opacity">
                        <button onClick={() => onEdit(site)} className="flex-1 text-xs font-medium py-1.5 px-2 bg-amber-50 text-amber-700 rounded-lg hover:bg-amber-100 transition flex items-center justify-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-3.5 w-3.5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                            </svg>
                            ç·¨è¼¯
                        </button>
                        <button onClick={() => onDelete(site)} className="flex-1 text-xs font-medium py-1.5 px-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition flex items-center justify-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-3.5 w-3.5" viewBox="0 0 20 20" fill="currentColor">
                                <path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                            åˆªé™¤
                        </button>
                    </div>
                )}
            </div>
        );
    }

    // --- ä¸»æ‡‰ç”¨ç¨‹å¼ ---
    function App() {
        const fbLib = useFirebaseLib(); // å–å¾— Firebase å‡½æ•¸åº«
        const [firebaseCtx, setFirebaseCtx] = useState(null); // å„²å­˜åˆå§‹åŒ–çš„å¯¦ä¾‹ (db, auth, storage)
        
        const [sites, setSites] = useState([]);
        const [isLoading, setIsLoading] = useState(true);
        const [isSubmitting, setIsSubmitting] = useState(false);
        const [isAdmin, setIsAdmin] = useState(false);
        const [isAuthenticated, setIsAuthenticated] = useState(false);
        const [isLoginModalOpen, setLoginModalOpen] = useState(false);
        const [isEditModalOpen, setEditModalOpen] = useState(false);
        const [isDeleteModalOpen, setDeleteModalOpen] = useState(false);
        const [currentSite, setCurrentSite] = useState(null);
        
        // æœå°‹åŠŸèƒ½ç‹€æ…‹
        const [searchTerm, setSearchTerm] = useState('');

        const initialNewSiteState = {
            name: '',
            url: '', 
            githubUrl: '', 
            showFileLink: true,
            showGithubLink: true,
            showGeminiLink: true,
        };
        const [newSite, setNewSite] = useState(initialNewSiteState);
        const [newSiteFile, setNewSiteFile] = useState(null);
        const [passwordInput, setPasswordInput] = useState('');
        const [loginError, setLoginError] = useState('');
        const [notification, setNotification] = useState({ show: false, message: '', success: true });

        // é€šçŸ¥ Helper
        const showNotification = useCallback((message, success = true) => {
            setNotification({ show: true, message, success });
            setTimeout(() => setNotification({ show: false, message: '', success: true }), 3000);
        }, []);

        // åˆå§‹åŒ– Firebase å¯¦ä¾‹èˆ‡ç™»å…¥
        useEffect(() => {
            if (!fbLib) return;
            
            try {
                // åˆå§‹åŒ– App
                const app = fbLib.initializeApp(firebaseConfig);
                const auth = fbLib.getAuth(app);
                const db = fbLib.getFirestore(app);
                const storage = fbLib.getStorage(app);
                
                // å„²å­˜å¯¦ä¾‹åˆ° Context ç‹€æ…‹
                setFirebaseCtx({ app, auth, db, storage, lib: fbLib });

                // åŒ¿åç™»å…¥
                fbLib.signInAnonymously(auth)
                    .then(() => {
                        console.log("Firebase signed in");
                        setIsAuthenticated(true);
                    })
                    .catch((error) => {
                        console.error("Anonymous sign-in failed:", error);
                        showNotification("ç³»çµ±ç™»å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š", false);
                    });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
            }
        }, [fbLib]); // åªåœ¨ fbLib è¼‰å…¥å¾ŒåŸ·è¡Œä¸€æ¬¡

        // ç›£è½è³‡æ–™
        useEffect(() => {
            if (!firebaseCtx || !isAuthenticated) return;
            const { db, lib } = firebaseCtx;
            const { collection, query, orderBy, onSnapshot } = lib;
            
            setIsLoading(true);
            const sitesCollectionRef = collection(db, 'sites');
            const q = query(sitesCollectionRef, orderBy('name'));
            
            const unsubscribe = onSnapshot(q, (querySnapshot) => {
                const sitesData = querySnapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                setSites(sitesData);
                setIsLoading(false);
            }, (error) => {
                console.error("Error fetching sites: ", error);
                showNotification('è®€å–è³‡æ–™å¤±æ•—', false);
                setIsLoading(false);
            });
            return () => unsubscribe();
        }, [firebaseCtx, isAuthenticated, showNotification]);

        // æœå°‹éæ¿¾
        const filteredSites = useMemo(() => {
            if (!searchTerm) return sites;
            return sites.filter(site => 
                site.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
        }, [sites, searchTerm]);

        // å·¥å…·å‡½å¼
        const getPathFromUrl = (url) => {
            if (!url) return null;
            try {
                const bucket = firebaseConfig.storageBucket;
                const urlStart = `https://firebasestorage.googleapis.com/v0/b/${bucket}/o/`;
                if (!url.startsWith(urlStart)) return null;
                const filePathEncoded = url.split('?')[0].replace(urlStart, '');
                return decodeURIComponent(filePathEncoded);
            } catch (e) {
                console.error("Path parsing error:", e);
                return null;
            }
        };

        // è™•ç†ç®¡ç†å“¡ç™»å…¥
        const processLogin = () => {
            if (passwordInput === ADMIN_PASSWORD) {
                setIsAdmin(true);
                setLoginModalOpen(false);
                showNotification("ç™»å…¥æˆåŠŸï¼");
            } else {
                setLoginError("å¯†ç¢¼éŒ¯èª¤");
            }
        };

        // æ–°å¢ç¶²ç«™
        const handleAddSite = async (e) => {
            e.preventDefault();
            if (!firebaseCtx) return;
            const { db, storage, lib } = firebaseCtx;
            const { ref, uploadBytes, getDownloadURL, collection, addDoc } = lib;

            if (!newSite.name.trim() || !newSite.url.trim()) {
                showNotification("è«‹å¡«å¯«ç¶²ç«™åç¨±å’Œ Gemini ç¶²å€ã€‚", false);
                return;
            }
            setIsSubmitting(true);

            try {
                let downloadUrl = '';
                if (newSiteFile) {
                    const fileRef = ref(storage, `files/${Date.now()}_${newSiteFile.name}`);
                    await uploadBytes(fileRef, newSiteFile);
                    downloadUrl = await getDownloadURL(fileRef);
                }
                
                await addDoc(collection(db, 'sites'), { ...newSite, downloadUrl });
                setNewSite(initialNewSiteState);
                setNewSiteFile(null);
                document.getElementById('add-file-input').value = null;
                showNotification("æ–°å¢æˆåŠŸï¼");
            } catch (error) {
                console.error("Add error:", error);
                showNotification("æ–°å¢å¤±æ•—ã€‚", false);
            } finally {
                setIsSubmitting(false);
            }
        };

        // æ›´æ–°ç¶²ç«™
        const handleUpdateSite = async () => {
            if (!firebaseCtx || !currentSite) return;
            const { db, storage, lib } = firebaseCtx;
            const { ref, uploadBytes, getDownloadURL, deleteObject, doc, updateDoc } = lib;

            setIsSubmitting(true);

            try {
                let downloadUrl = currentSite.downloadUrl || '';
                const editFile = document.getElementById('edit-file-input')?.files[0];

                if (editFile) {
                    if (currentSite.downloadUrl) {
                        const oldFilePath = getPathFromUrl(currentSite.downloadUrl);
                        if (oldFilePath) {
                            try {
                               await deleteObject(ref(storage, oldFilePath));
                            } catch(e) { console.warn("Delete old file warning:", e); }
                        }
                    }
                    const newFileRef = ref(storage, `files/${Date.now()}_${editFile.name}`);
                    await uploadBytes(newFileRef, editFile);
                    downloadUrl = await getDownloadURL(newFileRef);
                }

                await updateDoc(doc(db, 'sites', currentSite.id), {
                    name: currentSite.name,
                    url: currentSite.url,
                    githubUrl: currentSite.githubUrl || '',
                    downloadUrl: downloadUrl,
                    showFileLink: currentSite.showFileLink,
                    showGithubLink: currentSite.showGithubLink,
                    showGeminiLink: currentSite.showGeminiLink,
                });
                setEditModalOpen(false);
                showNotification("æ›´æ–°æˆåŠŸï¼");
            } catch (error) {
                console.error("Update error:", error);
                showNotification("æ›´æ–°å¤±æ•—ã€‚", false);
            } finally {
                setIsSubmitting(false);
            }
        };

        // åˆªé™¤ç¶²ç«™
        const handleDeleteSite = async () => {
            if (!firebaseCtx || !currentSite) return;
            const { db, storage, lib } = firebaseCtx;
            const { ref, deleteObject, deleteDoc, doc } = lib;

            try {
                if (currentSite.downloadUrl) {
                    const filePath = getPathFromUrl(currentSite.downloadUrl);
                    if (filePath) await deleteObject(ref(storage, filePath));
                }
                await deleteDoc(doc(db, 'sites', currentSite.id));
                setDeleteModalOpen(false);
                showNotification("åˆªé™¤æˆåŠŸï¼");
            } catch (error) {
                console.error("Delete error:", error);
                showNotification("åˆªé™¤å¤±æ•—ã€‚", false);
            }
        };

        const handleNewSiteChange = (e) => {
            const { name, value, type, checked } = e.target;
            setNewSite(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));
        };
        
        const handleEditSiteChange = (e) => {
            const { name, value, type, checked } = e.target;
            setCurrentSite(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));
        };

        const openEditModal = (site) => {
            setCurrentSite({
                ...site,
                githubUrl: site.githubUrl || '',
                showFileLink: site.showFileLink !== false,
                showGithubLink: site.showGithubLink !== false,
                showGeminiLink: site.showGeminiLink !== false,
            });
            setEditModalOpen(true);
        };

        if (!fbLib) return <div className="text-center text-gray-500 mt-20"><div className="loader"></div><p>åˆå§‹åŒ–ç³»çµ±ä¸­...</p></div>;

        return (
            <div className="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
                {notification.show && <Notification {...notification} />}
                
                <header className="mb-8 bg-white p-5 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-600"></div>
                    <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                        <div>
                            <h1 className="text-xl sm:text-2xl font-bold text-gray-800 tracking-tight">ç ”ç™¼éƒ¨ç¶²é é€£çµåº«</h1>
                            <p className="text-gray-500 mt-1 text-xs sm:text-sm">å¿«é€Ÿå­˜å–ã€ç®¡ç†æ‰€æœ‰ç ”ç™¼å°ˆæ¡ˆé€£çµèˆ‡æª”æ¡ˆ</p>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="relative">
                                <input 
                                    type="text" 
                                    placeholder="ğŸ” æœå°‹..." 
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="pl-4 pr-8 py-1.5 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm w-40 sm:w-56 transition-all"
                                />
                                {searchTerm && (
                                    <button onClick={() => setSearchTerm('')} className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">âœ•</button>
                                )}
                            </div>
                            <button 
                                onClick={() => isAdmin ? (setIsAdmin(false), showNotification("å·²ç™»å‡º")) : (setLoginError(''), setPasswordInput(''), setLoginModalOpen(true))} 
                                className={`font-semibold py-1.5 px-4 rounded-full transition text-xs shadow-sm flex items-center gap-2 ${isAdmin ? 'bg-red-50 text-red-600 hover:bg-red-100 border border-red-200' : 'bg-gray-800 text-white hover:bg-gray-700'}`}
                            >
                                {isAdmin ? (
                                    <><span>ğŸ”’</span> ç™»å‡º</>
                                ) : (
                                    <><span>ğŸ”‘</span> ç®¡ç†</>
                                )}
                            </button>
                        </div>
                    </div>
                </header>

                {isLoading ? (
                    <div className="text-center text-gray-500 py-20">
                        <div className="loader"></div>
                        <p className="mt-4 font-medium text-sm">è¼‰å…¥è³‡æ–™ä¸­...</p>
                    </div>
                ) : (
                    <div className="card-container">
                        {filteredSites.length > 0 ? (
                            filteredSites.map(site => (
                                <SiteCard 
                                    key={site.id} 
                                    site={site} 
                                    isAdmin={isAdmin} 
                                    onEdit={openEditModal} 
                                    onDelete={(s) => { setCurrentSite(s); setDeleteModalOpen(true); }} 
                                />
                            ))
                        ) : (
                            <div className="col-span-full text-center py-20 bg-white rounded-2xl border border-dashed border-gray-300">
                                <p className="text-gray-400 text-base">
                                    {searchTerm ? `æ‰¾ä¸åˆ° "${searchTerm}"` : (isAdmin ? 'è«‹æ–°å¢ç¶²ç«™' : 'ç›®å‰æ²’æœ‰è³‡æ–™')}
                                </p>
                                {searchTerm && <button onClick={() => setSearchTerm('')} className="mt-2 text-blue-500 hover:underline text-sm">æ¸…é™¤æœå°‹</button>}
                            </div>
                        )}
                    </div>
                )}
                
                {/* æ–°å¢å€å¡Š */}
                {isAdmin && (
                    <div className="max-w-3xl mx-auto bg-white p-6 rounded-2xl shadow-lg mt-10 border border-gray-100">
                        <div className="flex items-center gap-2 mb-5 border-b pb-3">
                            <span className="text-xl">âœ¨</span>
                            <h2 className="text-lg font-bold text-gray-800">æ–°å¢è³‡æº</h2>
                        </div>
                        <form onSubmit={handleAddSite} className="space-y-4">
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div className="space-y-1">
                                    <label className="text-xs font-medium text-gray-700">ç¶²ç«™åç¨± <span className="text-red-500">*</span></label>
                                    <input type="text" name="name" value={newSite.name} onChange={handleNewSiteChange} placeholder="åç¨±" className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-blue-100 focus:border-blue-400 outline-none transition text-sm" required />
                                </div>
                                <div className="space-y-1">
                                    <label className="text-xs font-medium text-gray-700">Gemini ç¶²å€ <span className="text-red-500">*</span></label>
                                    <input type="url" name="url" value={newSite.url} onChange={handleNewSiteChange} placeholder="https://..." className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-blue-100 focus:border-blue-400 outline-none transition text-sm" required />
                                </div>
                            </div>
                            
                            <div className="space-y-1">
                                <label className="text-xs font-medium text-gray-700">GitHub (é¸å¡«)</label>
                                <input type="url" name="githubUrl" value={newSite.githubUrl} onChange={handleNewSiteChange} placeholder="https://github.com/..." className="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-blue-100 focus:border-blue-400 outline-none transition text-sm" />
                            </div>

                            <div className="space-y-1">
                                <label className="text-xs font-medium text-gray-700">ä¸Šå‚³æª”æ¡ˆ (é¸å¡«)</label>
                                <div className="relative border-2 border-dashed border-gray-300 rounded-lg p-4 hover:bg-gray-50 transition text-center cursor-pointer group">
                                    <input id="add-file-input" type="file" onChange={(e) => setNewSiteFile(e.target.files[0])} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"/>
                                    <div className="text-gray-500 group-hover:text-blue-500 transition text-sm">
                                        {newSiteFile ? (
                                            <p className="font-semibold text-blue-600">å·²é¸æ“‡: {newSiteFile.name}</p>
                                        ) : (
                                            <p>é»æ“Šæˆ–æ‹–æ›³æª”æ¡ˆ</p>
                                        )}
                                    </div>
                                </div>
                            </div>
                            
                            <div className="bg-gray-50 p-3 rounded-lg border border-gray-100">
                                <p className="text-xs font-bold text-gray-700 mb-2">è¨ªå®¢å¯è¦‹</p>
                                <div className="flex flex-wrap gap-4">
                                    <label className="flex items-center space-x-2 cursor-pointer select-none">
                                        <input type="checkbox" name="showFileLink" checked={newSite.showFileLink} onChange={handleNewSiteChange} className="form-checkbox h-4 w-4" />
                                        <span className="text-xs text-gray-600">æª”æ¡ˆ</span>
                                    </label>
                                    <label className="flex items-center space-x-2 cursor-pointer select-none">
                                        <input type="checkbox" name="showGithubLink" checked={newSite.showGithubLink} onChange={handleNewSiteChange} className="form-checkbox h-4 w-4" />
                                        <span className="text-xs text-gray-600">GitHub</span>
                                    </label>
                                    <label className="flex items-center space-x-2 cursor-pointer select-none">
                                        <input type="checkbox" name="showGeminiLink" checked={newSite.showGeminiLink} onChange={handleNewSiteChange} className="form-checkbox h-4 w-4" />
                                        <span className="text-xs text-gray-600">Gemini</span>
                                    </label>
                                </div>
                            </div>

                            <div className="pt-2">
                                <button type="submit" disabled={isSubmitting} className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-2.5 px-6 rounded-lg hover:shadow-lg hover:from-blue-700 hover:to-indigo-700 transform transition active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed text-sm">
                                    {isSubmitting ? <span className="btn-loader align-middle mr-2 w-4 h-4"></span> : 'ç¢ºèªæ–°å¢'}
                                </button>
                            </div>
                        </form>
                    </div>
                )}
                
                {/* ç™»å…¥ Modal */}
                {isLoginModalOpen && (
                    <Modal onClose={() => setLoginModalOpen(false)}>
                        <div className="text-center">
                            <div className="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-3 text-xl">ğŸ”</div>
                            <h2 className="text-lg font-bold mb-1">ç®¡ç†å“¡ç™»å…¥</h2>
                            <p className="text-xs text-gray-500 mb-4">è«‹è¼¸å…¥å¯†ç¢¼</p>
                            <input 
                                type="password" 
                                value={passwordInput} 
                                onChange={(e) => setPasswordInput(e.target.value)} 
                                onKeyDown={(e) => e.key === 'Enter' && processLogin()} 
                                placeholder="å¯†ç¢¼" 
                                className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-center tracking-widest text-sm" 
                                autoFocus 
                            />
                            {loginError && <p className="text-red-500 text-xs mt-2 animate-pulse">{loginError}</p>}
                            <div className="grid grid-cols-2 gap-3 mt-5">
                                <button onClick={() => setLoginModalOpen(false)} className="py-2 bg-gray-100 text-gray-600 font-medium rounded-lg hover:bg-gray-200 transition text-sm">å–æ¶ˆ</button>
                                <button onClick={processLogin} className="py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition shadow-md text-sm">ç™»å…¥</button>
                            </div>
                        </div>
                    </Modal>
                )}
                
                {/* ç·¨è¼¯ Modal */}
                {isEditModalOpen && currentSite && (
                    <Modal onClose={() => setEditModalOpen(false)} maxWidth="max-w-md">
                        <h2 className="text-lg font-bold mb-4 flex items-center gap-2">
                            <span className="text-amber-500">âœï¸</span> ç·¨è¼¯è³‡è¨Š
                        </h2>
                        <div className="space-y-3">
                            <div>
                                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">åç¨±</label>
                                <input type="text" name="name" value={currentSite.name} onChange={handleEditSiteChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 outline-none text-sm" />
                            </div>
                            <div>
                                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">Gemini</label>
                                <input type="url" name="url" value={currentSite.url} onChange={handleEditSiteChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 outline-none text-sm" />
                            </div>
                            <div>
                                <label className="block text-xs font-semibold text-gray-500 uppercase mb-1">GitHub</label>
                                <input type="url" name="githubUrl" value={currentSite.githubUrl} onChange={handleEditSiteChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-400 outline-none text-sm" />
                            </div>
                            
                            <div className="bg-amber-50 p-3 rounded-lg border border-amber-100">
                                <label className="block text-xs font-medium text-amber-900 mb-2">æ›´æ–°æª”æ¡ˆ</label>
                                {currentSite.downloadUrl && (
                                    <div className="text-xs text-amber-700 mb-2 flex items-center gap-1">
                                        <span>ğŸ“ ç›®å‰:</span>
                                        <a href={currentSite.downloadUrl} className="underline hover:text-amber-900" target="_blank">æŸ¥çœ‹</a>
                                    </div>
                                )}
                                <input id="edit-file-input" type="file" className="w-full text-xs text-gray-500 file:mr-3 file:py-1.5 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-white file:text-amber-700 hover:file:bg-amber-100"/>
                            </div>
                            
                            <div className="space-y-1 pt-1">
                                <p className="text-xs font-semibold text-gray-500 uppercase">é¡¯ç¤º</p>
                                <div className="flex gap-4">
                                    <label className="flex items-center space-x-2 cursor-pointer"><input type="checkbox" name="showFileLink" checked={currentSite.showFileLink} onChange={handleEditSiteChange} className="form-checkbox h-4 w-4" /><span className="text-xs">æª”æ¡ˆ</span></label>
                                    <label className="flex items-center space-x-2 cursor-pointer"><input type="checkbox" name="showGithubLink" checked={currentSite.showGithubLink} onChange={handleEditSiteChange} className="form-checkbox h-4 w-4" /><span className="text-xs">GitHub</span></label>
                                    <label className="flex items-center space-x-2 cursor-pointer"><input type="checkbox" name="showGeminiLink" checked={currentSite.showGeminiLink} onChange={handleEditSiteChange} className="form-checkbox h-4 w-4" /><span className="text-xs">Gemini</span></label>
                                </div>
                            </div>
                        </div>
                        <div className="flex justify-end gap-2 mt-6 pt-3 border-t">
                            <button onClick={() => setEditModalOpen(false)} className="px-4 py-1.5 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium text-sm">å–æ¶ˆ</button>
                            <button onClick={handleUpdateSite} disabled={isSubmitting} className="px-4 py-1.5 bg-amber-500 text-white rounded-lg hover:bg-amber-600 font-medium shadow-sm disabled:opacity-50 flex items-center text-sm">
                                {isSubmitting && <span className="btn-loader mr-2 w-3 h-3 border-2"></span>} å„²å­˜
                            </button>
                        </div>
                    </Modal>
                )}

                {/* åˆªé™¤ç¢ºèª Modal */}
                {isDeleteModalOpen && currentSite && (
                    <Modal onClose={() => setDeleteModalOpen(false)}>
                        <div className="text-center p-2">
                            <div className="w-10 h-10 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-3 text-xl">âš ï¸</div>
                            <h2 className="text-lg font-bold mb-1">ç¢ºèªåˆªé™¤ï¼Ÿ</h2>
                            <p className="text-gray-500 mb-5 text-sm">åˆªé™¤ã€Œ<span className="text-gray-800 font-bold">{currentSite.name}</span>ã€å¾Œç„¡æ³•å¾©åŸã€‚</p>
                            <div className="flex justify-center gap-3">
                                <button onClick={() => setDeleteModalOpen(false)} className="flex-1 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-medium text-sm">å–æ¶ˆ</button>
                                <button onClick={handleDeleteSite} className="flex-1 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium shadow-md text-sm">åˆªé™¤</button>
                            </div>
                        </div>
                    </Modal>
                )}
                
                <footer className="mt-10 mb-4 text-center text-gray-300 text-[10px]">
                    <p>Â© ç ”ç™¼éƒ¨</p>
                </footer>
            </div>
        );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>

</body>
</html>